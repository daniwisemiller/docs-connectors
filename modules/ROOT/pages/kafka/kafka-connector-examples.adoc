= Kafka Examples - Mule 4
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:imagesdir: ../../assets/images/

== Example: Consume a Topic

Kafka connector can be used for consuming messages from a particular topic and feeding the flow with those messages, or producing a message into a topic.

In Studio this is what you see:

Consumer:

image::kafka/kafka-consumer-studio-flow.png[Consumer on canvas]

Producer:

image::kafka/kafka-producer-studio-flow.png[Producer on canvas]

=== Use Case: XML

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
xmlns:kafka="http://www.mulesoft.org/schema/mule/kafka"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:spring="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans-current.xsd
	http://www.mulesoft.org/schema/mule/core
	http://www.mulesoft.org/schema/mule/core/current/mule.xsd
	http://www.mulesoft.org/schema/mule/http
	http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
	http://www.mulesoft.org/schema/mule/ee/core
	http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
	http://www.mulesoft.org/schema/mule/kafka
	http://www.mulesoft.org/schema/mule/kafka/current/mule-kafka.xsd">
    <configuration-properties file="mule-app.properties"></configuration-properties>
    <http:listener-config name="HTTP_Listener_config" 
      doc:name="HTTP Listener config"  >
        <http:listener-connection host="0.0.0.0" port="8081" />
    </http:listener-config>

    <kafka:kafka-consumer-config name="consumer-basic" doc:name="Consumer Basic" >
    <kafka:basic-kafka-consumer-connection 
    consumerPartitions="${consumer.topic.partitions}"
    groupId="${consumer.groupId}" 
    bootstrapServers="${config.basic.bootstrapServers}" />
  </kafka:kafka-consumer-config>
  <kafka:kafka-producer-config name="producer-basic" doc:name="Producer Basic" >
    <kafka:basic-kafka-producer-connection 
    bootstrapServers="${config.basic.bootstrapServers}" />
  </kafka:kafka-producer-config>

    <flow name="consumer-flow" >
        <kafka:consumer config-ref="consumer-krb-plain" 
        topic="${consumer.topic.name}"
        doc:name="Consumer" />
        <logger level="INFO" doc:name="Logger"
        message="#['New message arrived: ' ++ payload ++ &quot;, key:&quot; ++ attributes.key ++ &quot;, partition:&quot; ++ attributes.partition ++ &quot;, offset:&quot; ++ attributes.offset ]"/>
    </flow>
  <flow name="producer-flow" >
        <http:listener config-ref="HTTP_Listener_config" 
        path="/pushMessage" doc:name="Push message endpoint" doc:id="DOC_ID" />
        <logger level="INFO" doc:name="Logger" doc:id="DOC_ID"
        message="#[&quot;Message: '&quot; ++ payload.message ++ &quot;' published to topic: '&quot; ++ payload.topic ++ &quot;'.&quot;]" />
        <kafka:producer config-ref="producer-krb-plain" topic="#[payload.topic]"
                        key="#[now()]"
                        doc:name="Producer" >
            <kafka:message ><![CDATA[#[payload.message]]]></kafka:message>
        </kafka:producer>
        <set-payload value="Message successfully sent to Kafka topic." 
        doc:name="Push response builder" />
    </flow>
</mule>
----

== See Also

* https://forums.mulesoft.com[MuleSoft Forum]
* https://support.mulesoft.com/s/knowledge[Knowledge Base Articles]
